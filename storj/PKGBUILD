developer=https://storj.io/
url=https://github.com/storj/storj
maintainer=http://indiecomputing.com/
pkgname=$(basename $(pwd))
pkgver=0.30.5
pkgrel=1
pkgdesc="Storj V3 Network"
arch=('x86_64' 'armv6l' 'armv7l' 'aarch64')
license=("AGPL3")
makedepends=(
    'go'
)
sha512sums=('SKIP'
            'SKIP'
            'SKIP'
            'SKIP') # skip for now; needs platform-specific checksums
case "$(uname -m)" in
"x86_64")
     _platform=amd64
    ;;
"armv6l" | "armv7l" )
    _platform=arm
    ;;
"aarch64")
    _platform=arm64
    ;;
*)
    echo "ERROR: Unsupported platform" >&2; exit 1
    ;;
esac

source=(
    "gateway_linux_${_platform}_${pkgver}.zip::https://github.com/storj/storj/releases/download/v${pkgver}/gateway_linux_${_platform}.zip"
    "identity_linux_${_platform}_${pkgver}.zip::https://github.com/storj/storj/releases/download/v${pkgver}/identity_linux_${_platform}.zip"
    "linksharing_linux_${_platform}_${pkgver}.zip::https://github.com/storj/storj/releases/download/v${pkgver}/linksharing_linux_${_platform}.zip"
    "uplink_linux_${_platform}_${pkgver}.zip::https://github.com/storj/storj/releases/download/v${pkgver}/uplink_linux_${_platform}.zip"
)
releasepage=('https://github.com/storj/storj/releases/latest')


package() {
    # code
    install -m0755 -D ${srcdir}/{gateway,identity,linksharing,uplink}_linux_${_platform} -t ${pkgdir}/usr/bin/
    for f in gateway identity linksharing uplink; do
        ln -s ${f}_linux_${_platform} ${pkgdir}/usr/bin/storj-$f
    done

    # systemd
    install -m0644 -D ${startdir}/systemd/*.service -t ${pkgdir}/usr/lib/systemd/system/

    # config
    mkdir -m0755 -p ${pkgdir}/etc/storj/gateway
}

