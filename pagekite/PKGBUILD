developer="https://pagekite.org/"
maintainer="http://indiecomputing.com/"
pkgname=$(basename $(pwd))
pkgver=1.5.0.191126
pkgrel=1
pkgdesc='localhost tunneling via pagekite.net, integrated into ubos-admin'
arch=('any')
url=${developer}
license=('AGPL2')
depends=('python' 'python-setuptools' 'python-socksipychain' 'ubos-admin')
source=("pagekite-${pkgver}.tar.gz::https://github.com/pagekite/PyPagekite/archive/v${pkgver}.tar.gz")
releasepage=('https://github.com/pagekite/PyPagekite/releases')
sha512sums=('184c4d7435f85cc8a2c262081b1855387df9eea9c00e58ee7f36a61816cab6dc2096049f38c1eba7ca3af5f4d93fb89f7a22dc58e7bc6400951f451c727c15da')

_vendor_perl=/usr/share/perl5/vendor_perl

package() {
# Pagekite code
    cd "${srcdir}/PyPagekite-${pkgver}"
    python setup.py install --root="${pkgdir}/" --optimize=1

# Config
    mkdir -m0755 -p ${pkgdir}/etc/pagekite.d
    install -D -m0644 ${startdir}/etc/pagekite.d/*              -t ${pkgdir}/etc/pagekite.d/
    install -D -m0644 ${startdir}/etc/ubos/hostname-callbacks/* -t ${pkgdir}/etc/ubos/hostname-callbacks/

# Systemd
    install -D -m0644 ${startdir}/systemd/*.service -t ${pkgdir}/usr/lib/systemd/system/

# User
    install -D -m0644 ${startdir}/sysusers/* -t ${pkgdir}/usr/lib/sysusers.d/

# Code
    install -D -m0755 ${startdir}/vendor_perl/UBOS/Commands/*.pm          -t ${pkgdir}${_vendor_perl}/UBOS/Commands/
    install -D -m0755 ${startdir}/vendor_perl/UBOS/HostnameCallbacks/*.pm -t ${pkgdir}${_vendor_perl}/UBOS/HostnameCallbacks/
    install -D -m0755 ${startdir}/vendor_perl/UBOS/Pagekite/*.pm          -t ${pkgdir}${_vendor_perl}/UBOS/Pagekite/
}
